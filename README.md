
# Bioinformatics Analysis Scripts for High-Throughput Sequencing Data

This repository contains shell scripts for analyzing different types of high-throughput sequencing data, including ChIP-seq, QTL-mapping, RNA-seq, and sRNA-seq. Each script follows a standardized workflow for environment setup, data preprocessing, alignment, analysis, and visualization.


## Table of Contents
#Scripts Overview
	Shell-script-QTL-mapping.sh
	R-script-QTL-mapping.R
	Shell-script-RNA_seq.sh
	Shell-script-ChIP-seq.sh
	Shell-script-sRNA_seq.sh
#Dependencies
#Usage Instructions
#Contribution
#License

## Scripts Overview

### Shell-script-QTL-mapping.sh
**Purpose**: Perform quantitative trait locus (QTL) mapping via whole-genome sequencing (WGS) data analysis.  
**Workflow**:  
1. **Environment Setup**: Create a Conda environment for WGS analysis (GATK4, BWA, PLINK, etc.).  
2. **Data Cleaning**: Trim reads with `trimmomatic`.  
3. **Quality Check**: Assess read quality with `fastqc`.  
4. **Alignment**: Align reads to the reference genome using BWA and mark duplicates with GATK.  
5. **Variant Calling**: Detect SNPs/INDELs using GATK's HaplotypeCaller and filter variants based on quality metrics.  
6. **Data Filtering**: Filter variants by missing rate, minor allele frequency (MAF), and depth using `vcftools`.  
7. **Kinship & LD Analysis**: Calculate kinship matrices with `emmax` and analyze linkage disequilibrium with `LDBlockShow`.  

**Key Tools**: `conda`, `trimmomatic`, `fastqc`, `bwa`, `gatk4`, `samtools`, `vcftools`, `plink`, `emmax`.


### R-script-QTL-analysis.R  
**Purpose**: Perform statistical analysis and visualization for QTL mapping results using the `rMVP` R package, including multi-locus mixed-model analysis and Manhattan plot generation.  

**Workflow**:  
1. **Package Installation**: Install the `rMVP` package from GitHub for advanced QTL mapping analysis.  
2. **Data Preparation**:  
   - Load phenotypic data (`pheno.txt`), preprocessed VCF data (`Filter-samples.vcf`), and kinship matrices generated by the QTL-mapping shell script.  
   - Format data into structures compatible with `rMVP` (genotype, phenotype, genetic map, kinship matrix).  
3. **Multi-Locus Analysis**:  
   - Use the `MVP()` function to execute three analysis methods: **GLM** (General Linear Model), **MLM** (Mixed Linear Model), and **FarmCPU** (Fixed and Random Model Circulating Probability Unification).  
   - Set parameters for principal components (PCs), computational efficiency (`maxLine`), and statistical thresholds (FDR/Bonferroni corrections).  
4. **Visualization**:  
   - Generate a **Manhattan plot** to visualize genome-wide association signals, adjusting chromosome positions for contiguous display.  
   - Highlight significant loci using FDR and Bonferroni correction thresholds, with custom styling for clarity.  

**Key Tools & Packages**:  
- `R` (v4.0+), `devtools`, `rMVP` (for QTL mapping), `ggplot2` (implicit for plotting, though script uses base R graphics).  

**Code Snippets**:  
```r  
# Install rMVP from GitHub
devtools::install_github("xiaolei-lab/rMVP")

# Load data and run multi-locus analysis
library(rMVP)
MVP.Data(filePhe="pheno.txt", fileVCF="Filter-samples.vcf", out="pop")
MVP.Data.Kin("name.BN.kinf", out="pop", maxLine=1e4, sep='\t')
genotype <- attach.big.matrix("pop.geno.desc")
phenotype <- read.table("pop.phe", head=TRUE)
imMVP <- MVP(
    phe=phenotype, geno=genotype, K=Kinship,
    nPC.GLM=5, nPC.MLM=3, nPC.FarmCPU=3,
    method=c("GLM", "MLM", "FarmCPU")
)

# Generate Manhattan plot with FDR/Bonferroni thresholds
chr.length <- c(22923084, 21262383, ...)  # Chromosome lengths for position adjustment
gwas.data <- read.table("FarmCPU.txt", sep="\t", header=TRUE)
png("FarmCPU_213s_GWAS-t2.png", res=200, height=1500, width=3200)
plot(x, y, type="p", ...)  # Custom plotting with colored points and threshold lines
dev.off()
```  


### Shell-script-RNA_seq.sh
**Purpose**: Analyze RNA-seq data for gene expression quantification.  
**Workflow**:  
1. **Environment Setup**: Create a Conda environment for RNA-seq analysis (Hisat2, HTSeq, etc.).  
2. **Data Cleaning**: Trim adapter sequences and low-quality bases with `trimmomatic`.  
3. **Quality Check**: Generate quality reports with `fastqc`.  
4. **Alignment**: Align reads to a transcriptome-indexed reference genome using Hisat2 (with splice site/exon annotations).  
5. **Format Conversion**: Convert SAM to sorted BAM files and index them with `samtools`.  
6. **Expression Quantification**: Count reads per gene using `htseq-count` based on GTF annotations.  

**Key Tools**: `conda`, `trimmomatic`, `fastqc`, `hisat2`, `samtools`, `htseq-count`.


### Shell-script-ChIP-seq.sh
**Purpose**: Process ChIP-seq data to identify chromatin immunoprecipitation peaks.  
**Workflow**:  
1. **Environment Setup**: Create a Conda environment with tools for ChIP-seq analysis (Bowtie2, Trimmomatic, MACS2, etc.).  
2. **Data Cleaning**: Trim adapter sequences and low-quality bases using `trimmomatic`.  
3. **Quality Check**: Generate quality reports with `fastqc`.  
4. **Alignment**: Align reads to reference genomes (e.g., `P_INF_CHROMOSOMES.fasta`, `Pm3010_flye.fasta`) using Bowtie2.  
5. **Format Conversion**: Convert SAM to sorted BAM files and index them with `samtools`.  
6. **Peak Calling**: Identify peaks using `macs2` with input samples as controls.  
7. **Visualization**: Generate bigWig files for coverage visualization with `bamCompare` (from Deeptools).  

**Key Tools**: `conda`, `trimmomatic`, `fastqc`, `bowtie2`, `samtools`, `macs2`, `bamCompare`.


### Shell-script-sRNA_seq.sh
**Purpose**: Analyze small RNA (sRNA) sequencing data for small RNA discovery and profiling.  
**Workflow**:  
1. **Environment Setup**: Create a Conda environment for sRNA analysis (FastX-Toolkit, Bowtie2, ShortStack, etc.).  
2. **Quality Filtering**: Trim low-quality bases and adaptors with `fastx_trimmer`.  
3. **Quality Check**: Assess read quality with `fastqc`.  
4. **Alignment**: Align reads to reference genomes using Bowtie2.  
5. **Format Conversion**: Convert SAM to sorted BAM files and index them with `samtools`.  
6. **Peak Analysis**: Identify small RNA-enriched regions with `ShortStack`.  
7. **Visualization**: Generate coverage bigWig files with `BamCoverage` (from Deeptools).  

**Key Tools**: `conda`, `fastx_toolkit`, `fastqc`, `bowtie2`, `samtools`, `ShortStack`, `BamCoverage`.


## Dependencies
### Conda Environments
Create environments using the specified YAML files (or directly via commands in the scripts):  
```bash

# QTL-mapping environment
conda env create -n WGS -c bioconda -c conda-forge gatk4 bwa plink samtools=1.9 vcftools snpeff python=3.7 trimmomatic=0.35 fastqc

# RNA-seq environment
conda env create -n RNA -c bioconda -c conda-forge hisat2 samtools htseq python=3.7 trimmomatic=0.35 fastqc igvtools

# ChIP-seq environment
conda env create -n ChIP -c bioconda -c conda-forge bowtie2 deeptools samtools macs2 trimmomatic=0.35 fastqc igvtools

# sRNA-seq environment
conda env create -n sRNA -c bioconda -c conda-forge fastx_toolkit samtools bowtie deeptools
```

**R Environment**:  
  ```bash  
  # Install R (if not present)
  sudo apt-get install r-base  # Ubuntu/Debian example
  # Install required packages
  R -e "install.packages(c('devtools'))"
  R -e "devtools::install_github('xiaolei-lab/rMVP')"
  ```  

## Usage Instructions
1. **Clone the Repository**:  
   ```bash
   git clone https://github.com/NJAU-FanZ/HSE1_QTL-mapping.git
   cd your-repo
   ```

2. **Prepare Input Data**:  
   - Organize input files (fastq/fasta/gtf) in the specified directories (e.g., `clean/`, `Ref/`, `CleanDATA/`). Replace placeholder filenames (e.g., `sample_1.clean.fq.gz`) with actual file paths.
   - Ensure the QTL-mapping shell script has generated `Filter-samples.vcf` and kinship files (`name.BN.kinf`).  
   - Organize phenotypic data (`pheno.txt`), genetic map (`pop.geno.map`), and kinship matrices in the working directory.  

3. **Run Scripts**:  
   Activate the corresponding Conda environment and execute the script:  
   ```bash
   conda activate ChIP   # For ChIP-seq analysis
   bash Shell-script-ChIP-seq.sh
   ```

4. **Run the R Script**:  
   ```bash  
   Rscript R-script-QTL-analysis.R
   ```  
   - Outputs include intermediate `rMVP` objects (`imMVP`), association results (`FarmCPU.txt`), and a Manhattan plot (`FarmCPU_213s_GWAS-t2.png`).  

## Contribution
Contributions are welcome! Please fork the repository, create a feature branch, and submit a pull request with clear documentation of changes.


## License
This project is open-source. Feel free to use and modify the scripts for non-commercial research purposes. For commercial use, contact the repository owner.

---  
*Last updated: [2025/04/16]*  
*Maintained by: [Fan Zhang]*  
*Email: [T2023018@njau.edu.cn]*
